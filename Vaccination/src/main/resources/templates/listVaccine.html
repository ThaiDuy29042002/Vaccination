<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Vaccine List</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"/>
    <link rel="stylesheet" th:href="@{/css/styles.css}"/>
</head>
<body>

<div class="container">
    <div class="row">
        <div class="col-md-12 mt-5">
            <h1 class="text-center">List of Vaccine</h1>
        </div>

        <div class="col-md-12 mt-3">
            <!--            <label for="entries">Show entries:</label>-->
            <!--            <select id="entries" onchange="changeEntries()">-->
            <!--                <option value="1">1</option>-->
            <!--                <option value="5">5</option>-->
            <!--                <option value="10">10</option>-->
            <!--            </select>-->
            <button onclick="goBack()" class="btn btn-success mt-2">Back</button>
            <table id="table-view" class="table table-bordered">
                <thead>
                <tr>
                    <th>
                        <input type="checkbox" onclick="toggle(this);"/><br/>
                    </th>
                    <th>#ID</th>
                    <th>vaccineName</th>
                    <th>timeBeginNextInjection</th>
                    <th>timeEndNextInjection</th>
                    <th>origin</th>
                    <th>status</th>
                    <!--                        <th>Actions</th>-->
                </tr>
                </thead>
                <tbody>
                <tr th:each="vaccine : ${listVaccine}">
                    <td><input type="checkbox" name="vaccineID" id="vaccineID" th:value="${vaccine.vaccineID}"></td>
                    <td th:text="${vaccine.vaccineID}"></td>
                    <td th:text="${vaccine.vaccineName}"></td>
                    <td th:text="${#dates.format(vaccine.timeBeginNextInjection, 'dd-MM-yyyy')}"></td>
                    <td th:text="${#dates.format(vaccine.timeEndNextInjection, 'dd-MM-yyyy')}"></td>
                    <td th:text="${vaccine.origin}"></td>
                    <td th:switch="${vaccine.status}" class="text-center" th:data-id="${vaccine.vaccineID}">
                        <span class="badge badge-success" th:case="true">Active</span>
                        <span class="badge badge-danger" th:case="false">Inactive</span>
                    </td>
                    <!--                        <td>-->
                    <!--                            <a th:href="@{/product/edit (id=${product.vaccineID})}"-->
                    <!--                               class="btn btn-primary btn-sm mt-2">Update</a>-->
                    <!--                            <a class="btn btn-danger btn-sm mt-2" data-toggle="modal" data-target="#confirmDeleteModal"-->
                    <!--                               th:data-id="${product.vaccineID}">Delete</a>-->
                    <!--                        </td>-->
                </tr>
                </tbody>
            </table>
            <button onclick="updateSelectedVaccines()" class="btn btn-primary mt-2">Update</button>
            <button onclick="deleteSelectedVaccine()" class="btn btn-primary mt-2">Make-Inactive</button>

        </div>
    </div>
</div>

<!-- js -->
<script src="vendors/scripts/core.js"></script>
<script src="vendors/scripts/script.min.js"></script>
<script src="vendors/scripts/process.js"></script>
<script src="vendors/scripts/layout-settings.js"></script>
<script src="src/plugins/datatables/js/jquery.dataTables.min.js"></script>
<script src="src/plugins/datatables/js/dataTables.bootstrap4.min.js"></script>
<script src="src/plugins/datatables/js/dataTables.responsive.min.js"></script>
<script src="src/plugins/datatables/js/responsive.bootstrap4.min.js"></script>
<!-- buttons for Export datatable -->
<script src="src/plugins/datatables/js/dataTables.buttons.min.js"></script>
<script src="src/plugins/datatables/js/buttons.bootstrap4.min.js"></script>
<script src="src/plugins/datatables/js/buttons.print.min.js"></script>
<script src="src/plugins/datatables/js/buttons.html5.min.js"></script>
<script src="src/plugins/datatables/js/buttons.flash.min.js"></script>
<script src="src/plugins/datatables/js/pdfmake.min.js"></script>
<script src="src/plugins/datatables/js/vfs_fonts.js"></script>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<!-- Datatable Setting js -->
<script src="vendors/scripts/datatable-setting.js"></script>
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" role="dialog" aria-labelledby="confirmDeleteModalLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmDeleteModalLabel">Confirm Delete</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this data?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" onclick="deleteSelectedVaccine()" class="btn btn-danger">Delete</button>
            </div>
        </div>
    </div>
</div>
<script>
    function toggle(source) {
        var checkboxes = document.querySelectorAll('input[type="checkbox"]');
        for (var i = 0; i < checkboxes.length; i++) {
            if (checkboxes[i] != source)
                checkboxes[i].checked = source.checked;
        }
    }

    function goBack() {
        window.history.back();
    }

    $('#confirmDeleteModal').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget);
        var vaccineID = button.data('id');
        var deleteButton = $('#deleteButton');
        deleteButton.attr('onclick', 'customDeleteFunction("' + vaccineID + '")');
    });

    function customDeleteFunction(vaccineID) {
        $.ajax({
            url: '/vaccine/delete?id=' + vaccineID,
            type: 'DELETE',
            success: function () {
                $('#confirmDeleteModal').modal('hide');
                $('#table-view').find('td[data-id="' + vaccineID + '"]').eq(0).html('<span class="badge badge-danger">Inactive</span>');
            },
            error: function () {
                alert('Failed to delete item!');
                $('#confirmDeleteModal').modal('hide');
            }
        });
    }

    function confirmDelete(vaccineID) {
        $('#confirmDeleteModal').modal('show');
        var deleteButton = $('#confirmDeleteModal').find('.modal-footer button.btn-danger');
        deleteButton.attr('onclick', 'customDeleteFunction("' + vaccineID + '")');
    }

    function deleteSelectedVaccine() {
        var selectedVaccineIDs = $("input[name='vaccineID']:checked").map(function () {
            return $(this).val();
        }).get();
        if (selectedVaccineIDs.length !== 1) {
            alert("Only choose one");
            return;
        }
        var isInactiveSelected = false;
        selectedVaccineIDs.forEach(function (vaccineID) {
            var vaccineStatus = $('#table-view').find('td[data-id="' + vaccineID + '"] .badge').text().trim();
            if (vaccineStatus.toLowerCase() === 'inactive') {
                isInactiveSelected = true;
            }
        });
        if (isInactiveSelected) {
            alert("Alreay Inactive!");
            return;
        }
        confirmDelete(selectedVaccineIDs[0]);
    }

    function updateSelectedVaccines() {
        var selectedVaccineIDs = [];
        var hasInactiveVaccine = false;
        $("input[name='vaccineID']:checked").each(function () {
            var vaccineID = $(this).val();
            var vaccineStatus = $('#table-view').find('td[data-id="' + vaccineID + '"] .badge').text().trim();
            if (vaccineStatus.toLowerCase() === 'inactive') {
                hasInactiveVaccine = true;
            } else {
                selectedVaccineIDs.push(vaccineID);
            }
        });
        if (hasInactiveVaccine) {
            alert("Invalid data - please recheck your selects!");
            return;
        }
        if (selectedVaccineIDs.length !== 1) {
            alert("Only choose one");
            return;
        }
        window.location.href = '/vaccine/edit?id=' + selectedVaccineIDs[0];
    }

    // function changeEntries() {
    //     var selectedValue = parseInt(document.getElementById("entries").value, 10);
    //
    //     // Lấy tất cả các hàng trong bảng
    //     var rows = document.getElementById("table-view").getElementsByTagName("tr");
    //
    //     // Ẩn tất cả các hàng
    //     for (var i = 0; i < rows.length; i++) {
    //         rows[i].style.display = "none";
    //     }
    //
    //     // Hiển thị số lượng hàng tương ứng với giá trị đã chọn
    //     for (var i = 0; i < selectedValue; i++) {
    //         if (rows[i]) {
    //             rows[i].style.display = "";
    //         }
    //     }
    // }
    // function deleteSelectedVaccine() {
    //     var selectedVaccineIDs = [];
    //     $("input[name='vaccineID']:checked").each(function () {
    //         selectedVaccineIDs.push($(this).val());
    //     });
    //     if (selectedVaccineIDs.length !== 1) {
    //         alert("Only choose one");
    //         return;
    //     }
    //     customDeleteFunction(selectedVaccineIDs[0]);
    // }

</script>
</body>
</html>